on:
  push

name: Build and deploy website

jobs:
  build-images:
    name: Build images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install node deps
        #run: npm install
        run: echo "npm install"
      - name: Build images
        #run: node image-converter.mjs
        run: |
          mkdir assets/images
          touch assets/images/testfile.txt
          echo test > assets/images/testfile.txt
      - uses: actions/upload-artifact@v4
        with:
          name: built-images
          path: assets/images

  build-website:
    name: Build website
    needs: build-images
    runs-on: ubuntu-latest
    steps:
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
      - uses: actions/checkout@v4
        with:
          submodules: 'true'
          token: ${{ secrets.CI_TOKEN }}
      - uses: actions/download-artifact@v4
        with:
          name: built-images
          path: assets/images
      - name: Install jekyll deps
        run: bundle install
      - name: Copy _plugins directory
        run: cp -r _themes/safex/_plugins ./
      - name: List files
        run: |
          ls -la
          ls -la _plugins
      - name: Build website
        run: JEKYLL_ENV=production bundle exec jekyll build
      - uses: actions/upload-artifact@v4
        with:
          name: built-website
          path: _site

  upload:
    name: Upload to FTP
    needs: build-website
    runs-on: ubuntu-latest
    steps:
      - name: Download artifacts
        uses: actions/download-artifact@v4
        with:
          name: built-website
      - name: List files
        run: ls -la _site

#      - name: upload files
#        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
#        with:
#          server: ${{ secrets.FTP_SERVER }}
#          username: ${{ secrets.FTP_USER }}
#          password: ${{ secrets.FTP_PASS }}
#          server-dir: wp-content/themes/safex-twentytwentyfour/
#          local-dir: safex-twentytwentyfour/
